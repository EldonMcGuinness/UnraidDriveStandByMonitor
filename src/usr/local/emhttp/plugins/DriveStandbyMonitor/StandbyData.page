Menu="DriveStandbyMonitor:2"
Title="Standby Data"
Tag="table"
Markdown="false"
---
<?
#Pull some default data
libxml_use_internal_errors(true); # Suppress any warnings from xml errors.
$docroot = $docroot ?? $_SERVER['DOCUMENT_ROOT'] ?: '/usr/local/emhttp';
$script = "DriveStandbyMonitor";
$defaults = @parse_ini_file("$docroot/plugins/DriveStandbyMonitor/default.cfg") ?: [];
$DB_LOCATION = $defaults["DB_LOCATION"];


$DB_FILE = "${DB_LOCATION}/monitor.db";
$DRIVE_STATUS = array();

$sql_data = "SELECT * from 'standby' order by 'standby'.'drive', 'standby'.'date' DESC;";
$sql_drives = "SELECT 'standby'.'drive' from 'standby' group by 'standby'.'drive' order by 'standby'.'drive' ASC;";

# Get the DB info and data on the drives
$sqlite = new SQLite3( $DB_FILE );
$data_result = $sqlite->query( $sql_data );
$drives_result = $sqlite->query( $sql_drives );
?>

<style type="text/css">
    .inner-wrapper {
        margin: 48px;
        text-align: center;
    }

    .inner-wrapper .table {

        margin-top:24px;
    }

    .inner-wrapper .table .row {

        display: flex;
        flex-direction: row;
        justify-content: space-around;
        height:26px;
        overflow:hidden;
    }

    .inner-wrapper .table .row div{
        width:100%;
        padding: 5px;
    }

    .inner-wrapper .table .row.head {
        position: sticky;
        top: 39px;
        background: #e8e8e8;
    }

    .inner-wrapper  .table .row.cell.hidden {
        height:0px;
    }

    .inner-wrapper  .table .row.cell:nth-child(even) {
        background: #ffffff;
    }

    .inner-wrapper .table  .row.cell:nth-child(odd) {
        background: #f5f5f5;
    }

    .inner-wrapper .table .row.cell:hover {
        background: #c6c6c6;
    }

</style>    

<div class="inner-wrapper">
    <div>
        <span>Show Only:</span>
        <select id="show-only">
            <option value="all">All</option>
        <? while ($drives = $drives_result->fetchArray()) { ?>
            <option value="<?=$drives['drive']?>"><?=$drives['drive']?></option>
        <? } ?>
        </select>
    </div>
    <div class="table">
        <div class="row head">
            <div>Drive</div>
            <div>Standby</div>
            <div>Temperature (&deg;C)</div>
            <div>Time / Date</div>
        </div>
<? while ($data = $data_result->fetchArray(SQLITE3_ASSOC)) { ?>
        <div class="row cell <?=$data['drive']?>">
            <div><?=$data['drive']?></div>
            <div><? echo ($data['state']) ? "Active" : "Standby"; ?></div>
            <div><?=$data['temperature']?></div>
            <div><?echo date("H:i:s / Y-m-d", $data['date']); ?></div>
        </div>
<? } ?>

    </div>
</div>
<script type="text/javascript">
document.addEventListener( 'DOMContentLoaded', () => {
    document.querySelector("#show-only").addEventListener("change", (e) => {

        let rows = document.querySelectorAll(".table .row.cell");
        let selected = e.target.value;

        for ( let row of rows ){
            if ( row.classList.contains( selected ) || selected == "all" ) {
                row.classList.remove( "hidden" );

            } else {
                row.classList.add( "hidden" );

            }

        }
        
    });
});
</script>